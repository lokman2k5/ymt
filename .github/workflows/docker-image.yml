name: Fix Modal Image
on: workflow_dispatch

jobs:
  fix-manifest:
    runs-on: ubuntu-latest
    environment: docker
    steps:
      - name: Maximize Agent Disk Space
        uses: jlumbroso/free-disk-space@main
        with:
          # This deletes the massive pre-installed tools on the runner
          tool-cache: true
          android: true
          dotnet: true
          haskell: true
          codeql: true
          docker-images: true # Clears existing unused images

      - name: Login to Docker Hub
        uses: docker/login-action@v3
        with:
          username: ${{ secrets.DOCKERHUB_USERNAME }}
          password: ${{ secrets.DOCKERHUB_TOKEN }}

      - name: Pull and Push Fixed
        run: |
          echo "Starting pull (this may take a while)..."
          docker pull dockman56/melodify-saas:latest
          
          echo "Tagging..."
          docker tag dockman56/melodify-saas:latest dockman56/melodify-saas:modal-fixed
          
          echo "Pushing to Docker Hub..."
          docker push dockman56/melodify-saas:modal-fixed
